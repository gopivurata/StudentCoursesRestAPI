pipeline {
    agent {label 'node'}
    parameters {
        string(name: 'branch', defaultValue: 'master', description: 'job build on default branch master')
    }
    triggers { pollSCM('* * * * *') }
    stages {
        stage('git') {
            steps {
                git url: 'https://github.com/gopivurata/StudentCoursesRestAPI.git',
                    branch: "${params.branch}"
            }
        }
        stage('docker build') {
            environment { 
                AN_ACCESS_KEY = credentials('docker-credentials') 
            }
            steps {
                sh 'docker image build -t student-rest-api:1.0 .'
                sh 'docker image tag student-rest-api:1.0 gopivurata/student-rest-api:1.0'
                //sh 'echo $docker-credentials | docker login -u gopivurata --password-stdin'
                sh 'docker image push gopivurata/student-rest-api:1.0'
               // sh 'docker image tag student-rest-api:1.0 cdcd.jfrog.io/docker/student-rest-api:1.0'
                //sh 'docker login -ugopivurata1992@gmail.com cdcd.jfrog.io'
               // sh 'docker image push cdcd.jfrog.io/docker/student-rest-api:1.0'
        
            }
        }
        
    }
}